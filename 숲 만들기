import ipywidgets as widgets
from IPython.display import display, SVG, clear_output
import random

# --- 1. [ìˆ˜ì •] ì‹ë¬¼ ì¢…ë¥˜ ë° SVG ìƒì„± í•¨ìˆ˜ ---
# ìƒˆë¡œìš´ ê·œì¹™ì— ë§ê²Œ ì‹ë¬¼ ì¢…ë¥˜ë¥¼ ë‹¨ìˆœí™”í•˜ê³ , ê·¸ì— ë§ê²Œ SVG ìƒì„± ë¡œì§ì„ ìˆ˜ì •í•©ë‹ˆë‹¤.
PLANTS = {
    'sprout': {'emoji': 'ğŸŒ±', 'size': 30},
    'small_tree': {'emoji': 'ğŸŒ²', 'size': 40},
    'big_tree': {'emoji': 'ğŸŒ³', 'size': 55},
}

def create_forest_svg(plant_type=None):
    """
    ì£¼ì–´ì§„ ì‹ë¬¼ íƒ€ì…ì— ë§ëŠ” ìˆ² SVG ì´ë¯¸ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    """
    svg_elements = '<rect width="400" height="300" style="fill:skyblue" />'
    svg_elements += '<rect y="250" width="400" height="50" style="fill:limegreen" />'
    
    if plant_type in PLANTS:
        plant = PLANTS[plant_type]
        # í™”ë©´ ì¤‘ì•™ì— ì‹ë¬¼ì´ ë‚˜íƒ€ë‚˜ë„ë¡ ìœ„ì¹˜ ê³ ì •
        x_pos = 180 
        y_pos = 285 - plant['size']
        svg_elements += f'<text x="{x_pos}" y="{y_pos}" font-size="{plant["size"]}">{plant["emoji"]}</text>'
    else: # plant_typeì´ Noneì´ê±°ë‚˜ ì—†ì„ ê²½ìš° (ì ˆê° ì‹¤íŒ¨)
        svg_elements += '<text x="110" y="150" font-size="20">ì´ë²ˆ ì£¼ëŠ” ì•„ì‰½ë„¤ìš”!<br/>ë‹¤ìŒ ì£¼ ì ˆì•½ì— ì„±ê³µí•´ì„œ<br/>ìˆ²ì„ í‚¤ì›Œë³´ì„¸ìš”!</text>'
        
    return f'<svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">{svg_elements}</svg>'


# --- 2. [ìˆ˜ì •] ì‚¬ìš©ì ì…ë ¥ì„ ìœ„í•œ ìœ„ì ¯(UI) ìƒì„± ---
last_week_input = widgets.FloatText(
    value=1.5,
    description='ì§€ë‚œì£¼ ë°°ì¶œëŸ‰(kg):', # í…ìŠ¤íŠ¸ ë³€ê²½
    style={'description_width': 'initial'}
)
this_week_input = widgets.FloatText(
    value=0.8,
    description='ì´ë²ˆ ì£¼ ë°°ì¶œëŸ‰(kg):', # í…ìŠ¤íŠ¸ ë³€ê²½
    style={'description_width': 'initial'}
)
run_button = widgets.Button(
    description="ğŸŒ³ ì´ë²ˆ ì£¼ ìˆ² í™•ì¸í•˜ê¸°", # í…ìŠ¤íŠ¸ ë³€ê²½
    button_style='success'
)
output_area = widgets.Output()


# --- 3. [ìˆ˜ì •] ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰ë  í•¨ìˆ˜ ì •ì˜ ---
def on_run_button_clicked(b):
    from IPython.display import SVG, display, clear_output
    with output_area:
        clear_output(wait=True)

        last_week_co2 = last_week_input.value
        this_week_co2 = this_week_input.value
        
        print(f"ì…ë ¥ê°’: ì§€ë‚œì£¼ {last_week_co2} kg, ì´ë²ˆ ì£¼ {this_week_co2} kg")
        
        reduction = last_week_co2 - this_week_co2
        plant_to_grow = None # ê¸°ë³¸ê°’ì€ ì•„ë¬´ê²ƒë„ ì—†ëŠ” ìƒíƒœ

        # ìƒˆë¡œìš´ ê·œì¹™ì— ë”°ë¼ ì–´ë–¤ ì‹ë¬¼ì´ ìë„ì§€ ê²°ì •
        if reduction >= 0.58:
            plant_to_grow = 'big_tree'
            print(f"âœ… íƒ„ì†Œ ì €ê°ëŸ‰: {reduction:.2f} kg COâ‚‚e -> í° ë‚˜ë¬´ê°€ ìë¼ë‚˜ìš”!")
        elif reduction >= 0.19:
            plant_to_grow = 'small_tree'
            print(f"âœ… íƒ„ì†Œ ì €ê°ëŸ‰: {reduction:.2f} kg COâ‚‚e -> ì‘ì€ ë‚˜ë¬´ê°€ ìë¼ë‚˜ìš”!")
        elif reduction > 0:
            plant_to_grow = 'sprout'
            print(f"âœ… íƒ„ì†Œ ì €ê°ëŸ‰: {reduction:.2f} kg COâ‚‚e -> ìƒˆì‹¹ì´ ë‹ì•„ë‚¬ì–´ìš”!")
        else:
            print("âŒ ì´ë²ˆ ì£¼ì—ëŠ” íƒ„ì†Œë¥¼ ì €ê°í•˜ì§€ ëª»í–ˆì–´ìš”.")
            
        # ê²°ì •ëœ ì‹ë¬¼ë¡œ ìˆ² ì´ë¯¸ì§€ ìƒì„± ë° í‘œì‹œ
        forest_image_svg = create_forest_svg(plant_to_grow)
        print("\n--- ì´ë²ˆ ì£¼ ë‚˜ì˜ ìˆ² ---")
        display(SVG(forest_image_svg))


# --- 4. ë²„íŠ¼ê³¼ í•¨ìˆ˜ ì—°ê²° ë° UI í‘œì‹œ ---
run_button.on_click(on_run_button_clicked)

print("ì£¼ê°„ íƒ„ì†Œ ë°°ì¶œëŸ‰(kg COâ‚‚e)ì„ ì…ë ¥í•˜ê³  ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.")
display(last_week_input, this_week_input, run_button, output_area)
